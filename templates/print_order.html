<!doctype html>
<html lang="cs">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Objednávka {{ order.name }} - Hueppe</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      @media print {
        .no-print { display: none !important; }
      }
      body { font-size: 12px; }
      .header { border-bottom: 2px solid #000; margin-bottom: 20px; padding-bottom: 10px; }
      .summary { background: #f8f9fa; padding: 15px; margin: 20px 0; border: 1px solid #dee2e6; }
    </style>
  </head>
  <body>
    <div class="container">
      
      <div class="header">
        <div class="row">
          <div class="col-6">
            <h2>HUEPPE - Objednávka nakládky</h2>
            <h4>{{ order.name }}</h4>
          </div>
          <div class="col-6 text-end">
            <p><strong>Datum vystavení:</strong> {{ order.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
            {% if order.pickup_datetime %}
            <p><strong>Datum nakládky:</strong> {{ order.pickup_datetime.strftime('%d.%m.%Y %H:%M') }}</p>
            {% endif %}
          </div>
        </div>
      </div>

      {% if order.carrier_name or order.truck_license_plate %}
      <div class="summary">
        <h5>Informace o dopravě</h5>
        <div class="row">
          <div class="col-4">
            <strong>Dopravce:</strong><br>
            {{ order.carrier_name or 'neuvedeno' }}
          </div>
          <div class="col-4">
            <strong>Poznávací značka:</strong><br>
            {{ order.truck_license_plate or 'neuvedeno' }}
          </div>
          <div class="col-4">
            <strong>Datum nakládky:</strong><br>
            {{ order.pickup_datetime.strftime('%d.%m.%Y %H:%M') if order.pickup_datetime else 'neuvedeno' }}
          </div>
        </div>
      </div>
      {% endif %}

      <div class="summary">
        <h5>Přehled nákladu</h5>
        <div class="row">
          <div class="col-3">
            <strong>Lane 1:</strong><br>
            {{ '%.2f'|format(lane_totals[1]) }} m
          </div>
          <div class="col-3">
            <strong>Lane 2:</strong><br>
            {{ '%.2f'|format(lane_totals[2]) }} m
          </div>
          <div class="col-3">
            <strong>Lane 3:</strong><br>
            {{ '%.2f'|format(lane_totals[3]) }} m
          </div>
          <div class="col-3">
            <strong>Celkem:</strong><br>
            {{ '%.2f'|format(lane_totals[1]+lane_totals[2]+lane_totals[3]) }} m
          </div>
        </div>
        <hr>
        <div class="row">
          <div class="col-6">
            <strong>Paletových míst:</strong> {{ '%.2f'|format(pallet_places) }}
          </div>
          <div class="col-6">
            <strong>Cena:</strong> {{ price }} Kč {% if is_full %}<span class="badge bg-warning">Full truck</span>{% endif %}
          </div>
        </div>
      </div>

      <h5>Detail palet</h5>
      <table class="table table-sm table-bordered">
        <thead class="table-dark">
          <tr>
            <th>LSA</th>
            <th>Popis palety</th>
            <th>Délka (m)</th>
            <th>Hmotnost (kg)</th>
            <th>Lane</th>
          </tr>
        </thead>
        <tbody>
          {% for it in order.items|sort(attribute='assigned_lane') %}
            <tr>
              <td>{{ it.lsa }}</td>
              <td>{{ it.pallet_text }}</td>
              <td>{{ '%.2f'|format(it.length_m) }}</td>
              <td>{{ '%.1f'|format(it.weight) }}</td>
              <td>{{ it.assigned_lane or 'nezařazeno' }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      <div class="no-print mt-4">
        <button onclick="window.print()" class="btn btn-primary">Vytisknout</button>
        <a href="{{ url_for('order_view', order_id=order.id) }}" class="btn btn-secondary">Zpět na zakázku</a>
      </div>

    </div>
  </body>
</html>