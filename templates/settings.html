{% extends 'base.html' %}
{% block content %}
  <h3>NastavenÃ­ systÃ©mu</h3>
  
  <form action="{{ url_for('update_settings') }}" method="post">
    
    <div class="row">
      <div class="col-md-6">
        <h5>CenÃ­k</h5>
        
        <div class="mb-3">
          <label class="form-label">Cena za paletovÃ© mÃ­sto (KÄ)</label>
          <input type="number" step="0.01" name="price_per_place" value="{{ settings.price_per_place }}" class="form-control" required />
        </div>
        
        <div class="mb-3">
          <label class="form-label">Cena Full truck (KÄ)</label>
          <input type="number" step="0.01" name="full_truck_price" value="{{ settings.full_truck_price }}" class="form-control" required />
        </div>
        
        <h5>Kapacity vozidel</h5>
        
        <div class="mb-3">
          <label class="form-label">VÃ½chozÃ­ kapacita (m)</label>
          <input type="number" step="0.1" name="default_capacity_m" value="{{ settings.default_capacity_m }}" class="form-control" required />
        </div>
        
        <div class="mb-3">
          <label class="form-label">VelkokapacitnÃ­ vozidlo (m)</label>
          <input type="number" step="0.1" name="alternative_capacity_m" value="{{ settings.alternative_capacity_m }}" class="form-control" required />
        </div>
      </div>
      
      <div class="col-md-6">
        <h5>E-mailovÃ© notifikace</h5>
        
        <div class="mb-3">
          <label class="form-label">PÅ™Ã­jemci (oddÄ›leni ÄÃ¡rkou)</label>
          <textarea name="email_recipients" class="form-control" rows="3">{{ settings.email_recipients|join(', ') }}</textarea>
        </div>
        
        <h5>SMTP nastavenÃ­</h5>
        
        <div class="mb-3">
          <label class="form-label">SMTP server</label>
          <input type="text" name="smtp_host" value="{{ settings.smtp.host }}" class="form-control" />
        </div>
        
        <div class="mb-3">
          <label class="form-label">Port</label>
          <input type="number" name="smtp_port" value="{{ settings.smtp.port }}" class="form-control" />
        </div>
        
        <div class="mb-3">
          <label class="form-label">UÅ¾ivatelskÃ© jmÃ©no</label>
          <input type="text" name="smtp_username" value="{{ settings.smtp.username }}" class="form-control" />
        </div>
        
        <div class="mb-3">
          <label class="form-label">Heslo</label>
          <input type="password" name="smtp_password" value="{{ settings.smtp.password }}" class="form-control" />
        </div>
        
        <div class="mb-3">
          <label class="form-label">E-mail odesÃ­latele</label>
          <input type="email" name="smtp_from" value="{{ settings.smtp.from }}" class="form-control" />
        </div>
        
        <div class="mb-3 form-check">
          <input type="checkbox" name="smtp_use_tls" {{ 'checked' if settings.smtp.use_tls else '' }} class="form-check-input" id="tls" />
          <label class="form-check-label" for="tls">PouÅ¾Ã­t TLS</label>
        </div>
      </div>
    </div>
    
    <div class="mt-4">
      <button type="submit" class="btn btn-primary">UloÅ¾it nastavenÃ­</button>
      <a href="/beta" class="btn btn-secondary">ZpÄ›t</a>
    </div>
    
  </form>
  
  <!-- SprÃ¡va zÃ¡loh databÃ¡ze -->
  <hr class="mt-5">
  <div class="row">
    <div class="col-md-12">
      <h5>ğŸ—„ï¸ SprÃ¡va zÃ¡loh databÃ¡ze</h5>
      <p class="text-muted">ZÃ¡lohujte si databÃ¡zi pÅ™ed dÅ¯leÅ¾itÃ½mi zmÄ›nami nebo aktualizacemi systÃ©mu.</p>
      
      <div class="row">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h6 class="mb-0">ğŸ“¥ StÃ¡hnout zÃ¡lohu</h6>
            </div>
            <div class="card-body">
              <p class="small text-muted">Exportuje vÅ¡echna data (zakÃ¡zky, palety, soubory) do JSON souboru.</p>
              <a href="{{ url_for('backup_database') }}" class="btn btn-outline-success btn-sm">
                ğŸ’¾ StÃ¡hnout zÃ¡lohu databÃ¡ze
              </a>
            </div>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h6 class="mb-0">ğŸ“¤ NahrÃ¡t zÃ¡lohu</h6>
            </div>
            <div class="card-body">
              <p class="small text-muted">
                <strong class="text-warning">âš ï¸ Pozor:</strong> Toto vymaÅ¾e vÅ¡echna souÄasnÃ¡ data a nahradÃ­ je daty ze zÃ¡lohy!
              </p>
              <form method="post" action="{{ url_for('restore_database') }}" enctype="multipart/form-data" 
                    onsubmit="return confirm('Opravdu chcete nahradit vÅ¡echna data zÃ¡lohou? Tuto akci nelze vrÃ¡tit!')">
                <div class="mb-2">
                  <input type="file" name="backup_file" accept=".json" class="form-control form-control-sm" required>
                </div>
                <button type="submit" class="btn btn-outline-danger btn-sm">
                  ğŸ”„ Obnovit z zÃ¡lohy
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
      
      <div class="alert alert-info mt-3">
        <strong>ğŸ’¡ DoporuÄenÃ­:</strong>
        <ul class="mb-0">
          <li>VytvÃ¡Å™ejte zÃ¡lohu pravidelnÄ› (napÅ™. tÃ½dnÄ›)</li>
          <li>VytvoÅ™te zÃ¡lohu pÅ™ed kaÅ¾dou aktualizacÃ­ systÃ©mu</li>
          <li>UchovÃ¡vejte zÃ¡lohy na bezpeÄnÃ©m mÃ­stÄ› (Google Drive, Dropbox, atd.)</li>
          <li>Pojmenujte zÃ¡lohy s datem: <code>hueppe_backup_20251027.json</code></li>
        </ul>
      </div>
    </div>
  </div>
  
{% endblock %}